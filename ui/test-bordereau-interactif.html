<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Test Bordereau avec Signature - SNERTP</title>
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #f5f5f5;
}

.test-container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

h1 {
  color: #003366;
  text-align: center;
  margin-bottom: 30px;
}

.signature-section {
  margin-bottom: 30px;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 8px;
}

.signature-canvas {
  border: 2px solid #003366;
  background: white;
  cursor: crosshair;
  display: block;
  margin: 10px auto;
  touch-action: none;
}

.button-group {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 10px;
}

button {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  transition: all 0.3s;
}

.btn-primary {
  background: #003366;
  color: white;
}

.btn-primary:hover {
  background: #004488;
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-success {
  background: #28a745;
  color: white;
}

.btn-success:hover {
  background: #218838;
}

.btn-danger {
  background: #dc3545;
  color: white;
}

.btn-danger:hover {
  background: #c82333;
}

.preview {
  margin-top: 30px;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 8px;
}

.preview h2 {
  color: #003366;
  margin-bottom: 15px;
}

#preview-content {
  background: white;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
  min-height: 200px;
}

.info-box {
  background: #e7f3ff;
  border-left: 4px solid #003366;
  padding: 15px;
  margin-bottom: 20px;
}

.info-box h3 {
  margin-top: 0;
  color: #003366;
}
</style>
</head>
<body>

<div class="test-container">
  <h1>üß™ Test du Bordereau de Transmission avec Signature</h1>
  
  <div class="info-box">
    <h3>üìã Instructions</h3>
    <ol>
      <li>Dessinez votre signature dans la zone ci-dessous</li>
      <li>Cliquez sur "Enregistrer la signature"</li>
      <li>Cliquez sur "G√©n√©rer le bordereau"</li>
      <li>Le bordereau s'ouvrira dans une nouvelle fen√™tre</li>
      <li>Utilisez Ctrl+P ou Cmd+P pour l'imprimer ou l'enregistrer en PDF</li>
    </ol>
  </div>

  <div class="signature-section">
    <h2>‚úçÔ∏è Zone de signature</h2>
    <canvas id="signatureCanvas" class="signature-canvas" width="600" height="200"></canvas>
    <div class="button-group">
      <button class="btn-secondary" onclick="clearSignature()">üóëÔ∏è Effacer</button>
      <button class="btn-success" onclick="saveSignature()">üíæ Enregistrer la signature</button>
    </div>
    <div id="signature-status" style="text-align: center; margin-top: 10px; color: #666;"></div>
  </div>

  <div class="button-group">
    <button class="btn-primary" onclick="generateBordereau()" id="generateBtn" disabled>
      üìÑ G√©n√©rer le bordereau
    </button>
    <button class="btn-secondary" onclick="showPreview()">
      üëÅÔ∏è Aper√ßu
    </button>
  </div>

  <div class="preview" id="preview" style="display: none;">
    <h2>üëÅÔ∏è Aper√ßu de la signature</h2>
    <div id="preview-content"></div>
  </div>
</div>

<script>
let canvas, ctx;
let isDrawing = false;
let savedSignature = null;

// Initialisation
window.onload = function() {
  canvas = document.getElementById('signatureCanvas');
  ctx = canvas.getContext('2d');
  
  // Configuration du contexte
  ctx.lineWidth = 3;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  ctx.strokeStyle = '#000000';
  
  // Events souris
  canvas.addEventListener('mousedown', startDrawing);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDrawing);
  canvas.addEventListener('mouseout', stopDrawing);
  
  // Events tactiles
  canvas.addEventListener('touchstart', handleTouch);
  canvas.addEventListener('touchmove', handleTouch);
  canvas.addEventListener('touchend', stopDrawing);
};

function getCoordinates(e) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  
  return {
    x: (e.clientX - rect.left) * scaleX,
    y: (e.clientY - rect.top) * scaleY
  };
}

function startDrawing(e) {
  isDrawing = true;
  const coords = getCoordinates(e);
  ctx.beginPath();
  ctx.moveTo(coords.x, coords.y);
}

function draw(e) {
  if (!isDrawing) return;
  e.preventDefault();
  const coords = getCoordinates(e);
  ctx.lineTo(coords.x, coords.y);
  ctx.stroke();
}

function stopDrawing() {
  if (isDrawing) {
    ctx.closePath();
    isDrawing = false;
  }
}

function handleTouch(e) {
  e.preventDefault();
  const touch = e.touches[0];
  const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
    clientX: touch.clientX,
    clientY: touch.clientY
  });
  canvas.dispatchEvent(mouseEvent);
}

function clearSignature() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  savedSignature = null;
  document.getElementById('generateBtn').disabled = true;
  document.getElementById('signature-status').innerHTML = '';
  document.getElementById('preview').style.display = 'none';
}

function saveSignature() {
  savedSignature = canvas.toDataURL('image/png');
  document.getElementById('generateBtn').disabled = false;
  document.getElementById('signature-status').innerHTML = '‚úÖ Signature enregistr√©e';
  document.getElementById('signature-status').style.color = '#28a745';
}

function showPreview() {
  if (!savedSignature) {
    alert('Veuillez d\'abord enregistrer votre signature');
    return;
  }
  
  const preview = document.getElementById('preview');
  const content = document.getElementById('preview-content');
  content.innerHTML = `<img src="${savedSignature}" style="max-width: 100%; border: 1px solid #ddd; padding: 10px;">`;
  preview.style.display = 'block';
}

function generateBordereau() {
  if (!savedSignature) {
    alert('Veuillez d\'abord enregistrer votre signature');
    return;
  }
  
  const now = new Date();
  const dateStr = now.toLocaleDateString('fr-FR', { 
    day: '2-digit', 
    month: 'short', 
    year: 'numeric' 
  }).toUpperCase();
  
  const html = `<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Bordereau de transmission ‚Äì SNERTP</title>
<style>
body {
font-family: "Times New Roman", serif;
background: #fff;
color: #000;
margin: 0;
padding: 0;
}
.container {
width: 800px;
margin: auto;
border: 1px solid #000;
padding: 20px;
min-height: 1000px;
}
.header {
display: flex;
justify-content: space-between;
align-items: center;
}
.logo {
font-weight: bold;
font-size: 24px;
}
.org {
text-align: center;
font-size: 14px;
font-weight: bold;
}
.meta {
margin-top: 10px;
font-size: 12px;
}
.title {
text-align: center;
font-weight: bold;
margin: 20px 0;
text-transform: uppercase;
}
table {
width: 100%;
border-collapse: collapse;
font-size: 14px;
}
table, td {
border: 1px solid #000;
}
td {
padding: 8px;
vertical-align: top;
}
.label {
width: 30%;
font-weight: bold;
}
.signature {
margin-top: 40px;
text-align: center;
font-size: 14px;
}
.signature-img {
max-width: 300px;
margin: 10px auto;
display: block;
}
.footer {
margin-top: 20px;
font-size: 12px;
text-align: left;
}
.print-button {
position: fixed;
top: 20px;
right: 20px;
padding: 10px 20px;
background: #003366;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
font-size: 14px;
box-shadow: 0 2px 4px rgba(0,0,0,0.2);
z-index: 1000;
}
.print-button:hover {
background: #004488;
}
@media print {
  body { margin: 0; padding: 0; }
  .container { border: none; }
  .print-button { display: none; }
}
</style>
</head>
<body>

<button onclick="window.print()" class="print-button">üñ®Ô∏è Imprimer / PDF</button>

<div class="container">

<div class="header">
    <div class="logo">SNERTP</div>
    <div class="org">
        CENTRE NATIONAL D'ESSAIS ET DE<br>
        RECHERCHES DES TRAVAUX PUBLICS
    </div>
</div>

<div class="meta">
    N¬∞ : ${Math.floor(Math.random() * 10000)} / CNER-TP/DG<br>
    <br>
    Y. le ${dateStr}
</div>

<div class="title">
    Bordereau de transmission
</div>

<table>
    <tr>
        <td class="label">ESSAIS R√âALIS√âS SUR :</td>
        <td>
            √âchantillon de sol - Test de g√©n√©ration automatique
        </td>
    </tr>
    <tr>
        <td class="label">√Ä la demande de :</td>
        <td>Client Test</td>
    </tr>
    <tr>
        <td class="label">Pour le compte de :</td>
        <td>Client Test</td>
    </tr>
    <tr>
        <td class="label">DATE ET LIEU DES ESSAIS :</td>
        <td>${now.toLocaleDateString('fr-FR')} au Laboratoire Essais Sp√©ciaux</td>
    </tr>
    <tr>
        <td class="label">NATURE DES ESSAIS :</td>
        <td>
            Essais g√©otechniques (AG, Proctor, CBR)
        </td>
    </tr>
    <tr>
        <td class="label">ADRESSE DU R√âCEPTEUR DU RAPPORT DES ESSAIS :</td>
        <td>
            Client Test - Adresse de test
        </td>
    </tr>
    <tr>
        <td class="label">OBSERVATIONS :</td>
        <td>R.A.S.</td>
    </tr>
</table>

<div class="signature">
    Le Directeur G√©n√©ral<br><br>
    <img src="${savedSignature}" alt="Signature" class="signature-img" /><br>
    <strong>Kpadon C. MOUSSOUGAN</strong>
</div>

<div class="footer">
    Le pr√©sent rapport compte 1 page.
</div>

</div>

</body>
</html>`;
  
  const printWindow = window.open('', '_blank');
  if (printWindow) {
    printWindow.document.write(html);
    printWindow.document.close();
  } else {
    alert('Veuillez autoriser les pop-ups pour ce site');
  }
}
</script>

</body>
</html>
